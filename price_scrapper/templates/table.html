<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="fonts/icomoon/style.css">

    <link rel="stylesheet" href="../static/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../static/bootstrap.min.css">
    
    <!-- Style -->
    <link rel="stylesheet" href="../static/style.css">

    <title>Price scrapper table</title>
  </head>
  <body>
  <div class="content">
    <div class="container">
      <div class="table-responsive custom-table-responsive">
        <table class="table custom-table">
          <thead>
            <tr>  

              <th scope="col">
                <label class="control control--checkbox">
                  <input type="checkbox"  class="js-check-all"/>
                  <div class="control__indicator"></div>
                </label>
              </th>
              
              <th scope="col">Order</th>
              <th scope="col">Name</th>
              <th scope="col">Link</th>
              <th scope="col">Status</th>
              <th scope="col">Price</th>
            </tr>
          </thead>
          
          <tbody>
             {% for p in products %}
            <tr scope="row">
              <th scope="row">
                <label class="control control--checkbox">
                  <input type="checkbox"/>
                  <div class="control__indicator"></div>
                </label>
              </th>
              <td>
                {{p.id}}
              </td>
              <td><a href="#">{{p.name}}</a></td>
              <td style="max-width: 300px;">
                {{p.target_link}}
              </td>
              <td>{{p.crawl_status}}</td>
              <td>{{p.price}}</td>
            </tr>
            <tr class="spacer"><td colspan="100"></td></tr>
            
            {% endfor %}
          </tbody>
          <div>
            <button class="my-btn my-btn-class-31" id="updateProductListBtn" >Update Product List</button>

            <button class="my-btn my-btn-class-31" id="scrapAll">Scrap All</button>

            <button class="my-btn my-btn-class-31" id="webPriceUpdate">Update Web Prices</button>

            <style>
            .my-btn-class-31 { width: 200px; font-size: 16px; font-weight: 600; color: rgb(255, 255, 255); cursor: pointer; margin: 20px; height: 55px; text-align: center; border: none; background-size: 300% 100%; border-radius: 50px; transition: background 0.4s ease-in-out 0s; background-image: linear-gradient(to right, rgb(98, 83, 225), rgb(133, 45, 145), rgb(163, 161, 255), rgb(242, 70, 69)); box-shadow: rgba(126, 52, 161, 0.75) 0px 4px 15px 0px; }
            .my-btn-class-31:hover { background-position: 100% 0px; transition: background 0.4s ease-in-out 0s; }
            .my-btn-class-31:focus { outline: none; }
            .my-btn-class-31:active { box-shadow: rgba(126, 52, 161, 0.75) 0px 4px 5px 0px; transition: all 0.1s ease-in-out 0s; transform: translateY(2px); }
            </style>
            
        </div>
        
        </table>
      </div>

    </div>

  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
    $(document).ready(function() {
        $("#updateProductListBtn").click(function() {
            $.ajax({
                url: "{% url 'update-product-list' %}",  // URL of your Django view
                type: "GET",
                success: function(data) {
                    // Handle the success response here
                    if (data === true) {
                        // Refresh the page upon success
                        location.reload();
                    } else {
                        // Handle any other response if needed
                        alert("Update failed.");
                    }
                },
                error: function() {
                    // Handle errors here
                    alert("Error occurred during the update.");
                }
            });
        });
    });


    $(document).ready(function() {
        $("#scrapAll").click(function() {
            $.ajax({
                url: "{% url 'scrape_prices' %}",  // URL of your Django view
                type: "GET",
                success: function(data) {
                    // Handle the success response here
                    if (data['message'] === 'Success') {
                        // Refresh the page upon success

                        alert("Update Success.");
                        location.reload();
                    } else {
                        // Handle any other response if needed
                        alert("Update failed.");
                    }
                },
                error: function() {
                    // Handle errors here
                    alert("Error occurred during the update.");
                }
            });
        });
    });


    $(document).ready(function() {
        $("#webPriceUpdate").click(function() {
            $.ajax({
                url: "{% url 'web-prices' %}",  // URL of your Django view
                type: "GET",
                success: function(data) {
                    // Handle the success response here
                    if (data === true) {
                        // Refresh the page upon success
                        location.reload();
                    } else {
                        // Handle any other response if needed
                        alert("Update failed.");
                    }
                },
                error: function() {
                    // Handle errors here
                    alert("Error occurred during the update.");
                }
            });
        });
    });



    </script>
  </body>
</html>